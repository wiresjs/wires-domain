!function(e,r,i){function n(e){var r=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,i=/([^\s,]+)/g,n=e.toString().replace(r,""),t=n.slice(n.indexOf("(")+1,n.indexOf(")")).match(i);return null===t&&(t=[]),t}function t(e){var r={};if(r.localServices={},e.length>0){if(r.source=e[0],r.target=e[0],a.isPlainObject(e[0])){var i=e[0];r.target=i.target,r.source=i.source,r.instance=i.instance}if(e.length>1){var n=a.isString(e[0])||a.isArray(e[0]);n?(a.isArray(e[0])?r.source=e[0]:r.source=a.isString(e[0])?[e[0]]:e[0],a.isFunction(e[1])&&(r.target=e[1]),a.isFunction(e[2])&&(r.target=e[2])):(a.isFunction(e[1])&&(r.callReady=e[1]),a.isPlainObject(e[1])&&(r.localServices=e[1]))}3===e.length&&(a.isPlainObject(e[1])&&(r.localServices=e[1]),a.isFunction(e[2])&&(r.callReady=e[2]))}return r.target=r.target||function(){},r.source=r.source?r.source:r.target,r.callReady=r.callReady||function(){},r}var c,s,a,o,u={};e?(c=r,o=require("promise"),a=require("lodash"),s=require("log4js").getLogger("domain")):(i._||console.warn("Lodash is required for wires-domain!"),a=i._,c={},o=i.Promise,s={fatal:console.error,log:console.log,warn:console.warn}),c.__wires_services_cached__=c.__wires_services_cached__||{};var _=function(e){return e&&a.isFunction(e.then)&&a.isFunction(e["catch"])},l=function(e,r){return new o(function(i,n){var t=[],c=a.isPlainObject(e),s=-1,o=function(){if(s++,!(s<a.size(e)))return i(t);var u,l;if(c?(u=a.keys(e)[s],l=e[u]):(u=s,l=e[s]),_(l))l.then(function(e){t.push(e),o()})["catch"](n);else{var f=r.call(r,l,u);_(f)?f.then(function(e){t.push(e),o()})["catch"](n):(t.push(f),o())}};o()})},u={each:l,service:function(){this.register.apply(this,arguments)},module:function(e,r,i){i=i||{},i.cache=!0,this.register.apply(this,[e,r,i])},register:function(e,r,i){var n=null,t=r;a.isArray(r)&&(n=r,t=i);var s=!1;a.isPlainObject(i)&&(s=i.cache===!0),c.__wires_services__=c.__wires_services__||{},c.__wires_services__[e]={name:e,target:t,args:n,cache:s}},isServiceRegistered:function(e){return c.__wires_services__&&void 0!==c.__wires_services__[e]},requirePackage:function(e){var r={},i=this;return l(c.__wires_services__,function(n,t){var c=t.split(".")[0];return c===e?i.require([t],function(e){r[t]=e}):void 0}).then(function(){return r})},promise:function(e){return new o(e)},storeModule:function(e,r){c.__wires_services_cached__[e]=r},require:function(){var e=t(arguments),r=this,i=e.localServices,u=a.isArray(e.source)?e.source:n(e.source),_=e.target,f=(e.callReady,e.instance),h=c.__wires_services__,v=new o(function(n,t){var o=[],v=a.merge(i,h);for(var g in u){var d=(u[g],u[g]);if(!v[d])return s.fatal("Error while injecting variable '"+d+"' into function \n"+e.source.toString()),t({status:500,message:"Service with name '"+d+"' was not found "});o.push(v[d])}return l(o,function(e){if(e.cache&&c.__wires_services_cached__[e.name])return c.__wires_services_cached__[e.name];var n=e.target,t=e.args;if(a.isFunction(n)){var s=[];return s=t?[t,i,n]:[n,i],r.require.apply(r,s).then(function(i){return e.cache&&r.storeModule(e.name,i),i})}return n||e}).then(function(e){return _.apply(f||e,e)}).then(n)["catch"](t)});return v}};i.domain=u}("undefined"!=typeof module&&module.exports,"undefined"!=typeof module&&module.exports?global:this,this);